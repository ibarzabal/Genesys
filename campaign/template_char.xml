<?xml version="1.0" encoding="iso-8859-1"?>

<!--
  Please see the license.html file included with this distribution for
  attribution and copyright information.
-->

<root>

	<template name="button_inventorytab">
		<genericcontrol>
			<anchored width="85" height="31">
				<top parent="header" anchor="bottom" offset="4" />
				<right parent="inventorytab_rightanchor" anchor="left" relation="relative" offset="15" />
			</anchored>
			<icon>tabhorizontal</icon>
			<initcolor>FFB0B0B0</initcolor>
			<script>
				function onInit()
					if initcolor then
						setColor(initcolor[1])
					end
					if label then
						createLabel(label[1])
					elseif labelres then
						createLabel(Interface.getString(labelres[1]))
					end
				end
				function createLabel(sLabel)
					addTextWidget("tabtext_horizontal", sLabel)
				end
				function onClickDown(...)
					window.toggleTabButton(getName())
				end
			</script>
		</genericcontrol>
	</template>

	<template name="subwindow_charcontents">
		<subwindow name="contents">
			<anchored>
				<top offset="45" />
				<bottom offset="-25" />
				<left offset="15" />
				<right offset="-30" />
			</anchored>
			<activate />
			<fastinit />
		</subwindow>
	</template>
	<template name="scrollbar_charcontents">
		<scrollbar>
			<anchored to="contents" offset="-5,-10"/>
			<target>contents</target>
		</scrollbar>
	</template>

	<template name="label_charframetopg">
		<metalplate>
			<frame name="genesysplate1" offset="10,2,10,2"/>
			<font>subwindowsmalltitle</font>
			<center />
			<nodrag />
			<readonly />
<!--			<script file="campaign/scripts/char_labelframetop.lua" /> -->
		</metalplate>
	</template>

	<template name="label_charframetop">
		<metalplate>
			<frame name="metalplate" offset="10,2,10,2"/>
			<font>subwindowsmalltitle</font>
			<center />
			<nodrag />
			<readonly />
<!--			<script file="campaign/scripts/char_labelframetop.lua" /> -->
		</metalplate>
	</template>
	<template name="string_charframetop">
		<stringfield>
			<anchored position="insidetop" />
			<font>subwindowsmalltitle</font>
			<center />
			<nodrag/>
			<readonly />
		</stringfield>
	</template>

	<template name="label_charfieldtop">
		<label>
			<anchored position="above" offset="0,3" />
			<font>subwindowsmalltitle</font>
			<center />
		</label>
	</template>
	<template name="number_chartotal">
		<number_modifier>
			<frame name="fieldlight" offset="7,5,7,5" />
			<showemptywidget />
		</number_modifier>
	</template>


	<template name="number_chartotal">
		<number_modifier>
			<frame name="fieldlight" offset="7,5,7,5" />
			<showemptywidget />
		</number_modifier>
	</template>

	<template name="cycler_ability">
		<button_stringcycler>
			<parameters>
				<defaultlabelres mergerule="replace">dash</defaultlabelres>
				<labelsres>str|dex|con|int|wis|cha</labelsres>
				<values>strength|dexterity|constitution|intelligence|wisdom|charisma</values>
			</parameters>
		</button_stringcycler>
	</template>
	<template name="cycler_abilitybase">
		<cycler_ability>
			<parameters>
				<defaultlabelres mergerule="replace">base</defaultlabelres>
			</parameters>
		</cycler_ability>
	</template>

	<template name="list_abilities">
		<list_text>
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<allowcreate />
			<allowdelete />
			<sortby mergerule="replace"><control>name</control></sortby>
			<noscroll />
			<script>
				function onListChanged()
					update();
					if listheader and listheader[1] and not isVisible() then
						window[listheader[1]].expand();
					end
				end

				function update()
					local bEdit = (window.parentcontrol.window.actions_iedit.getValue() == 1);
					for _,w in ipairs(getWindows()) do
						w.name.setEnabled(bEdit);
						w.name.setLine(bEdit);
						w.idelete.setVisibility(bEdit);
					end
				end

				function addEntry(bFocus)
					local w = createWindow();
					if bFocus then
						w.name.setFocus();
					end
					return w;
				end
			</script>
		</list_text>
	</template>

	<template name="button_char_skills_iedit">
		<buttoncontrol>
			<anchored width="20" height="20" />
			<state icon="button_edit" tooltipres="button_editon" />
			<state icon="button_edit_down" tooltipres="button_editoff" />
			<script>
				function onInit()
					local node = window.getDatabaseNode();
					if not node or node.isReadOnly() then
						setVisible(false);
					end
				end

				function onValueChanged()
					window.contents.subwindow.skills_iadd.setVisible(getValue() == 1);
					window.contents.subwindow.skills.update();
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="string_char_background">
		<stringu>
			<multilinespacing>20</multilinespacing>
			<script>
				function onDrop(x, y, draginfo)
					if draginfo.isType("shortcut") then
						local sClass = draginfo.getShortcutData();
						if sClass == "reference_tableresult" then
							local node = draginfo.getDatabaseNode();
							local sNew = DB.getValue(node, "result", "");
							if sNew ~= "" then
								local aMerge = { };
								local sOld = getValue();
								if sOld ~= "" then
									table.insert(aMerge, sOld);
								end
								table.insert(aMerge, sNew);
								setValue(table.concat(aMerge, ";\n"));
							end
							return true;
						end
					end
				end
			</script>
		</stringu>
	</template>


	<template name="anchor_inventorytab_right">
		<genericcontrol name="inventorytab_rightanchor">
			<anchored height="0" width="0">
				<top />
				<left />
			</anchored>
<!--			<script>
				function onInit()
					setAnchor("left", "", "left", "absolute", #window.getTabNames()*75-10)
				end
			</script>  -->
		</genericcontrol>
	</template>


	<template name="derived_attribute">
		<number_dropadd>
			<hideonvalue value="0" />
		</number_dropadd>
	</template>


	<template name="windowtitlebar_char">
		<windowtitlebar>
			<bounds merge="replace">0,10,-1,40</bounds>
			<field>name</field>
			<font>subwindowtitle</font>
			<script>
				function setValue(sTitle)
					if widgetTitle then
						if prefix then
							sTitle = Interface.getString(prefix[1]) .. " - " .. sTitle;
						end
						widgetTitle.setText(sTitle);
						updatePosition();
					end
				end
			</script>
		</windowtitlebar>
	</template>
	<template name="anchor_title_charsheethelper">
		<genericcontrol>
			<anchored height="0">
				<top parent="title" anchor="bottom" offset="0" />
				<left parent="" anchor="left" offset="15" />
				<right parent="" anchor="right" offset="-15" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<template name="close_charsheethelper">
		<close>
			<anchored>
				<top offset="0" />
				<right offset="-8" />
			</anchored>
		</close>
	</template>
	<template name="resize_charsheethelper">
		<resize>
			<anchored>
				<right offset="-10" />
				<bottom offset="-10" />
			</anchored>
		</resize>
	</template>


	<template name="button_charfull">
		<windowreferencecontrol>
			<icon normal="button_fullsheet" pressed="button_fullsheet_down" />
			<class>charsheet</class>
			<tooltip textres="char_label_fullsheet" />
			<description field="name" />
			<script>
				function onClickRelease(button, x, y)
					local w = activate();
					if w then
						local tabindex = window.tabs.getIndex();
						if tabindex == 1 then
							w.tabs.activateTab(1);
						elseif tabindex == 2 then
							w.tabs.activateTab(4);
						elseif tabindex == 3 then
							w.tabs.activateTab(5);
						elseif tabindex == 4 then
							w.tabs.activateTab(7);
						end
					end
					return true;
				end
			</script>
		</windowreferencecontrol>
	</template>
	<template name="button_charmini">
		<windowreferencecontrol>
			<icon normal="button_minisheet" pressed="button_minisheet_down" />
			<class>charsheetmini</class>
			<tooltip textres="char_label_minisheet" />
			<description field="name" />
			<script>
				function onClickRelease(button, x, y)
					local w = activate();
					if w then
						local tabindex = window.tabs.getIndex();
						if tabindex == 1 or tabindex == 2 or tabindex == 6 then
							w.tabs.activateTab(1);
						elseif tabindex == 3 or tabindex == 4 then
							w.tabs.activateTab(2);
						elseif tabindex == 5 then
							w.tabs.activateTab(3);
						elseif tabindex == 7 then
							w.tabs.activateTab(4);
						end
					end
					return true;
				end
			</script>
		</windowreferencecontrol>
	</template>

	<template name="numberc_linked">
		<simplenumberc>
			<readonly />
			<source mergerule="resetandadd" />
			<script file="common/scripts/number_linked.lua" />
		</simplenumberc>
	</template>
	<template name="number_chartotal">
		<number_modifier>
			<frame name="fieldlight" offset="7,5,7,5" />
			<showemptywidget />
		</number_modifier>
	</template>
	<template name="number_chartotalwithability">
		<number_chartotal>
			<ability mergerule="resetandadd" />
			<script file="campaign/scripts/char_totalwithability.lua" />
		</number_chartotal>
	</template>
	<template name="number_chartotalnomod">
		<number_linked>
			<frame name="fieldlight" offset="7,5,7,5" />
		</number_linked>
	</template>
	<template name="number_chartotalwithabilitynomod">
		<number_chartotalnomod>
			<ability mergerule="resetandadd" />
			<script file="campaign/scripts/char_totalwithability.lua" />
		</number_chartotalnomod>
	</template>

<!--GENESYS-->
	<template name="number_charabilityscore">
		<basicnumber>
			<anchored position="belowleft" offset="0,10" width="32" height="32" />
			<default>2</default>
			<script file="campaign/scripts/sheetcharacteristicvalue.lua" />
		</basicnumber>
	</template>

	<template name="number_charminiabilityscore">
		<basicnumber>
			<anchored position="belowleft" offset="0,9" width="32" height="20" />
			<default>2</default>
			<script file="campaign/scripts/sheetcharacteristicvalue.lua" />
		</basicnumber>
	</template>

	<template name="initdicepool">
		<buttoncontrol>
			<rollable/>
				<script file="campaign/scripts/initdicepool.lua" />
		</buttoncontrol>
	</template>

	<template name="number_charskilltotal">
		<numberfield>
			<frame name="fieldlight" offset="7,5,7,5" />
<!--			<displaysign /> -->
		</numberfield>
	</template>


	<template name="string_charabilitylabel">
		<label>
			<anchored position="lefthigh" width="120" height="24" />
			<static />
		</label>
	</template>
	<template name="string_charminiabilitylabel">
		<label>
			<anchored position="lefthigh" width="85" height="20" />
			<static />
		</label>
	</template>

	<template name="number_charminiabilitydamage">
		<number_charabilitydamage>
			<anchored position="right" offset="55,0" width="30" />
		</number_charabilitydamage>
	</template>


	<template name="button_charmainskill">
		<button_roll>
			<anchored to="anchor_charmainskill">
				<left anchor="right" relation="relative" offset="15" />
				<top />
			</anchored>
			<script>
				local sSkill;

				function onInit()
					sSkill = Interface.getString(skill[1]);

					if sSkill then
						setTooltipText(sSkill .. " " .. Interface.getString("char_tooltip_skillcheck"));
					end
				end

				function action(draginfo)
					if sSkill then
						local nodeChar = window.getDatabaseNode();
						local rActor = ActorManager.getActor("pc", nodeChar);

						local nValue = CharManager.getSkillValue(rActor, sSkill);

						ActionSkill.performRoll(draginfo, rActor, sSkill, nValue);
					end
				end

				function onButtonPress()
					action();
				end

				function onDragStart(button, x, y, draginfo)
					action(draginfo);
					return true;
				end
			</script>
		</button_roll>
	</template>

	<template name="label_charmainskill">
		<stringcontrol>
			<anchored position="aboveleft" offset="-10,0" width="40" />
			<font>sheetlabelmini</font>
			<center />
		</stringcontrol>
	</template>

	<template name="number_charinit">
		<number_chartotalwithability>
			<rollable />
			<displaysign />
			<modifiersize>mini</modifiersize>
			<modifierfield>initiative.temporary</modifierfield>
			<source><name>initiative.misc</name><op>+</op></source>
			<ability><source>initiative.ability</source><default>dexterity</default></ability>
			<script>
				function action(draginfo)
					local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
					ActionInit.performRoll(draginfo, rActor);

					return true;
				end

				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end

				function onDoubleClick(x,y)
					return action();
				end
			</script>
		</number_chartotalwithability>
	</template>
	<template name="number_charattacktotal">
		<number_chartotalwithability>
			<rollable />
			<displaysign />
			<modifiersize>mini</modifiersize>
			<script>
				function action(draginfo)
					local sText = Interface.getString(self.description[1].textres[1]);
					local rActor, rAttack = CharManager.getBaseAttackRollStructures(sText, window.getDatabaseNode());

					ActionAttack.performRoll(draginfo, rActor, rAttack);
					return true;
				end

				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end

				function onDoubleClick(x,y)
					return action();
				end
			</script>
		</number_chartotalwithability>
	</template>
	<template name="number_charmeleetotal">
		<number_charattacktotal>
			<description><textres>char_tooltip_atkmelee</textres></description>
			<modifierfield>attackbonus.melee.temporary</modifierfield>
			<source><name>attackbonus.base</name><op>+</op></source>
			<source><name>attackbonus.melee.size</name><op>+</op></source>
			<source><name>attackbonus.melee.misc</name><op>+</op></source>
			<ability><source>attackbonus.melee.ability</source><default>strength</default></ability>
		</number_charattacktotal>
	</template>
	<template name="number_charrangedtotal">
		<number_charattacktotal>
			<description><textres>char_tooltip_atkranged</textres></description>
			<modifierfield>attackbonus.ranged.temporary</modifierfield>
			<source><name>attackbonus.base</name><op>+</op></source>
			<source><name>attackbonus.ranged.size</name><op>+</op></source>
			<source><name>attackbonus.ranged.misc</name><op>+</op></source>
			<ability><source>attackbonus.ranged.ability</source><default>dexterity</default></ability>
		</number_charattacktotal>
	</template>
	<template name="number_chargrappletotal">
		<number_chartotalwithability>
			<rollable />
			<displaysign />
			<modifiersize>mini</modifiersize>
			<description><text>Grapple</text></description>
			<modifierfield>attackbonus.grapple.temporary</modifierfield>
			<source><name>attackbonus.base</name><op>+</op></source>
			<source><name>attackbonus.grapple.size</name><op>+</op></source>
			<source><name>attackbonus.grapple.misc</name><op>+</op></source>
			<ability><source>attackbonus.grapple.ability</source><default>strength</default></ability>
			<script>
				function action(draginfo)
					local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
					local rAttack = CharManager.getGrappleRollStructures(rActor, "");

					ActionAttack.performGrappleRoll(draginfo, rActor, rAttack);
					return true;
				end

				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end

				function onDoubleClick(x,y)
					return action();
				end
			</script>
		</number_chartotalwithability>
	</template>

	<template name="number_chartotalac">
		<number_chartotalwithability>
			<description textres="ac" />
			<modifiersize>mini</modifiersize>
			<modifierfield>ac.sources.temporary</modifierfield>
			<source><name>ac.sources.armor</name><op>+</op></source>
			<source><name>ac.sources.shield</name><op>+</op></source>
			<source><name>ac.sources.size</name><op>+</op></source>
			<source><name>ac.sources.naturalarmor</name><op>+</op></source>
			<source><name>ac.sources.deflection</name><op>+</op></source>
			<source><name>ac.sources.dodge</name><op>+</op></source>
			<source><name>ac.sources.misc</name><op>+</op></source>
			<source><name>encumbrance.armormaxstatbonus</name></source>
			<source><name>encumbrance.armormaxstatbonusactive</name></source>
			<ability><source>ac.sources.ability</source><default>dexterity</default></ability>
			<ability><source>ac.sources.ability2</source></ability>
			<script>
				function onSourceUpdate()
					local nMaxMod = -1;
					local bMaxActive = sources["encumbrance.armormaxstatbonusactive"].getValue();
					if bMaxActive &gt; 0 then
						nMaxMod = sources["encumbrance.armormaxstatbonus"].getValue();
					end

					local nAbility = getAbilityBonus(nMaxMod);

					setValue(10 + calculateSources() + nAbility);
				end
			</script>
		</number_chartotalwithability>
	</template>
	<template name="number_charflatfootedac">
		<number_chartotalwithabilitynomod>
			<description textres="armorclassff" />
			<source><name>ac.sources.armor</name><op>+</op></source>
			<source><name>ac.sources.shield</name><op>+</op></source>
			<source><name>ac.sources.size</name><op>+</op></source>
			<source><name>ac.sources.naturalarmor</name><op>+</op></source>
			<source><name>ac.sources.deflection</name><op>+</op></source>
			<source><name>ac.sources.ffmisc</name><op>+</op></source>
			<source><name>ac.sources.temporary</name><op>+</op></source>
			<ability><source>ac.sources.ability</source><default>dexterity</default></ability>
			<ability><source>ac.sources.ability2</source></ability>
			<script>
				function onSourceUpdate()
					local nAbility = getAbilityBonus();
					if nAbility &gt; 0 then
						nAbility = 0;
					end

					setValue(10 + calculateSources() + nAbility);
				end
			</script>
		</number_chartotalwithabilitynomod>
	</template>
	<template name="number_chartouchac">
		<number_chartotalwithabilitynomod>
			<description textres="armorclasstouch" />
			<source><name>ac.sources.size</name><op>+</op></source>
			<source><name>ac.sources.deflection</name><op>+</op></source>
			<source><name>ac.sources.dodge</name><op>+</op></source>
			<source><name>ac.sources.touchmisc</name><op>+</op></source>
			<source><name>ac.sources.temporary</name><op>+</op></source>
			<source><name>encumbrance.armormaxstatbonus</name></source>
			<source><name>encumbrance.armormaxstatbonusactive</name></source>
			<ability><source>ac.sources.ability</source><default>dexterity</default></ability>
			<ability><source>ac.sources.ability2</source></ability>
			<script>
				function onSourceUpdate()
					local nMaxMod = -1;
					local bMaxActive = sources["encumbrance.armormaxstatbonusactive"].getValue();
					if bMaxActive &gt; 0 then
						nMaxMod = sources["encumbrance.armormaxstatbonus"].getValue();
					end

					local nAbility = getAbilityBonus(nMaxMod);

					setValue(10 + calculateSources() + nAbility);
				end
			</script>
		</number_chartotalwithabilitynomod>
	</template>
	<template name="number_charcmd">
		<number_chartotalwithabilitynomod>
			<description textres="cmd" />
			<source><name>ac.sources.size</name><op>-</op></source>
			<source><name>ac.sources.deflection</name><op>+</op></source>
			<source><name>ac.sources.dodge</name><op>+</op></source>
			<source><name>ac.sources.cmdmisc</name><op>+</op></source>
			<source><name>ac.sources.temporary</name><op>+</op></source>
			<ability><source>ac.sources.ability</source><default>dexterity</default></ability>
			<ability><source>ac.sources.ability2</source></ability>
			<ability><source>ac.sources.cmdbase</source><default>bab</default></ability>
			<ability><source>ac.sources.cmdability</source><default>strength</default></ability>
			<script>
				function onSourceUpdate()
					local nAbility = getAbilityBonus();

					setValue(10 + calculateSources() + nAbility);
				end
			</script>
		</number_chartotalwithabilitynomod>
	</template>

	<template name="number_charsr">
		<number_chartotal>
			<modifiersize>mini</modifiersize>
			<description textres="spellresistance" />
			<modifierfield>defenses.sr.temporary</modifierfield>
			<source><name>defenses.sr.base</name><op>+</op></source>
			<source><name>defenses.sr.misc</name><op>+</op></source>
		</number_chartotal>
	</template>

	<template name="number_charspeed">
		<number_chartotal>
			<modifierfield>speed.temporary</modifierfield>
			<modifiersize>mini</modifiersize>
			<description textres="char_tooltip_speed" />
			<source><name>speed.base</name><op>+</op></source>
			<source><name>speed.armor</name><op>+</op></source>
			<source><name>speed.misc</name><op>+</op></source>
		</number_chartotal>
	</template>

	<template name="cycler_charability">
		<cycler_ability>
			<script>
				function onValueChanged()
					if window.isInitialized() then
						local sValue = getStringValue();
						if sValue == "" and baseability then
							sValue = baseability[1];
						end

						local sCharRelative = "";
						if abilityrelative then
							sCharRelative = abilityrelative[1];
						end

						if fieldabilitymod and window[fieldabilitymod[1]] then
							window[fieldabilitymod[1]].updateAbility(sCharRelative, sValue);
						end
					end
				end
			</script>
		</cycler_ability>
	</template>
	<template name="number_charabilitymod">
		<simplenumber>
			<readonly />
			<displaysign />
			<disabled />
			<script>
				local sLocalAbility = "";
				local nodeLocal = nil;
				local nodeCreature = nil;

				function updateAbility(sCharRelative, sAbility)
					if sLocalAbility == sAbility then
						return;
					end
					if nodeLocal then
						nodeLocal.onUpdate = function () end;
						nodeLocal = nil;
						nodeCreature = nil;
					end

					if sAbility ~= "" then
						local nodeSpellClass = window.getDatabaseNode();
						nodeCreature = nodeSpellClass.getChild(sCharRelative);
						local nodeParent = nodeCreature.getParent();

						if ActorManager.isPC(nodeCreature) then
							if StringManager.contains(DataCommon.abilities, sAbility) then
								nodeLocal = nodeCreature.getChild("abilities." .. sAbility .. ".bonus");
							elseif sAbility == "bab" then
								nodeLocal = nodeCreature.getChild("attackbonus.base");
							elseif sAbility == "level" then
								nodeLocal = nodeCreature.getChild("level");
							end
						else
							if StringManager.contains(DataCommon.abilities, sAbility) then
								nodeLocal = nodeCreature.getChild(sAbility);
							elseif sAbility == "bab" then
								nodeLocal = nodeCreature.getChild("babgrp");
							elseif sAbility == "level" then
								nodeLocal = nodeCreature.getChild("hd");
							end
						end

						if nodeLocal then
							nodeLocal.onUpdate = updateValue;
							sLocalAbility = sAbility;
						end
					end

					updateValue();
				end

				function updateValue()
					if nodeLocal then
						local nodeParent = nodeCreature.getParent();

						if nodeParent.getName() == "charsheet" then
							setValue(nodeLocal.getValue());
						elseif nodeParent.getName() == "npc" then
							local rActor = ActorManager.getActor("npc", nodeCreature);
							local nValue = ActorManager2.getAbilityBonus(rActor, sLocalAbility);
							setValue(nValue);
						end
					else
						setValue(0);
					end
				end
			</script>
		</simplenumber>
	</template>

	<template name="number_charcombatmod">
		<basicnumber>
			<anchored position="right" offset="8,0" width="28" />
			<displaysign />
		</basicnumber>
	</template>
	<template name="number_charcombatmod_static">
		<simplenumber>
			<anchored position="below" offset="0,8" height="20" />
			<displaysign />
			<nodrag />
			<readonly />
		</simplenumber>
	</template>
	<template name="string_charcombatmod_blank">
		<stringcontrol>
			<anchored position="below" offset="0,8" height="20" />
			<disabled />
			<static>-</static>
			<center />
		</stringcontrol>
	</template>
	<template name="cycler_charcombatability">
		<cycler_charability>
			<anchored position="righthigh" offset="8,0" height="20" width="32" />
		</cycler_charability>
	</template>
	<template name="number_charcombatabilitymod">
		<number_charabilitymod>
			<anchored position="right" offset="4,0" width="28" />
		</number_charabilitymod>
	</template>
	<template name="number_charcombatabilitymod_static">
		<numberc_linked>
			<anchored position="below" offset="0,8" height="20" />
			<ability mergerule="resetandadd" />
			<script file="campaign/scripts/char_totalwithability.lua" />
			<displaysign />
			<nodrag />
			<ability><source>ac.sources.ability</source><default>dexterity</default></ability>
			<ability><source>ac.sources.ability2</source></ability>
		</numberc_linked>
	</template>

	<template name="number_charsave">
		<number_chartotalwithability>
			<rollable />
			<displaysign />
			<modifiersize>mini</modifiersize>
			<script>
				function onInit()
					addSourceWithOp("saves." .. target[1] .. ".base", "+");
					addSourceWithOp("saves." .. target[1] .. ".misc", "+");

					super.onInit();
				end

				function action(draginfo)
					local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
					ActionSave.performRoll(draginfo, rActor, target[1]);
					return true;
				end

				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end

				function onDoubleClick(x,y)
					return action();
				end
			</script>
		</number_chartotalwithability>
	</template>
	<template name="number_charsavefort">
		<number_charsave>
			<modifierfield>saves.fortitude.temporary</modifierfield>
			<target>fortitude</target>
			<ability><source>saves.fortitude.ability</source><default>constitution</default></ability>
		</number_charsave>
	</template>
	<template name="number_charsaveref">
		<number_charsave>
			<modifierfield>saves.reflex.temporary</modifierfield>
			<target>reflex</target>
			<ability><source>saves.reflex.ability</source><default>dexterity</default></ability>
		</number_charsave>
	</template>
	<template name="number_charsavewill">
		<number_charsave>
			<modifierfield>saves.will.temporary</modifierfield>
			<target>will</target>
			<ability><source>saves.will.ability</source><default>wisdom</default></ability>
		</number_charsave>
	</template>


	<template name="list_charskill">
		<windowlist>
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<datasource>.skilllist</datasource>
			<class>char_skill</class>
			<sortby>
				<control>name</control>
			</sortby>
			<script file="campaign/scripts/char_skilllist.lua" />
		</windowlist>
	</template>

	<template name="list_npcskill">
		<windowlist>
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<datasource>.skilllist</datasource>
			<class>npc_skill</class>
			<sortby>
				<control>name</control>
			</sortby>
			<script file="campaign/scripts/char_skilllist.lua" />
		</windowlist>
	</template>



	<template name="button_career_checkbox">
		<buttonfield>
			<state icon="button_career_off" />
			<state icon="button_career_on" />
		</buttonfield>
	</template>


	<template name="buttongroup_skill_counter">
		<genericcontrol>
			<stateicons>
				<on>button_skill_on</on>
				<off>button_skill_off</off>
			</stateicons>
			<script file="common/scripts/buttongroup_counter.lua" />
		</genericcontrol>
	</template>

	<template name="buttongroup_skill_counteri">
		<genericcontrol>
			<stateicons>
				<on>button_skill_on</on>
				<off>button_skill_off_inv</off>
			</stateicons>
			<script file="common/scripts/buttongroup_counter.lua" />
		</genericcontrol>
	</template>

	<!-- GENERAL skilllist LIST! .......................................................................... -->
	<windowclass name="char_skill">
	<margins control="0,0,0,2" />
	<script file="campaign/scripts/char_skill.lua" />
	<sheetdata>
		<button_career_checkbox name="career_skill">
			<bounds>22,8,12,12</bounds>
			<script>
			function onInit()
				if window.windowlist.window.parentcontrol.window.getClass() == "npc" then
					if string.lower(window.windowlist.window.parentcontrol.window.main_npc_category.getValue()) == "minion" then
						setVisible(true);
						setTooltipText("Minion skill?");
					else
						setVisible(false);
					end
				else
					setTooltipText("Career Skill");
				end

			end

			function onValueChanged()
				if window.windowlist.window.parentcontrol.window.getClass() == "npc" then
					if string.lower(window.windowlist.window.parentcontrol.window.main_npc_category.getValue()) == "minion" then
						MinionManager.updateSkill(window.getDatabaseNode());
					end
				end
			end
		</script>
		</button_career_checkbox>
		<genericcontrol name="rightanchor">
			<anchored width="0" height="0">
				<top />
				<right />
			</anchored>
			<invisible />
		</genericcontrol>
		<button_idelete name="idelete">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
			</anchored>
		</button_idelete>
		<genericcontrol name="idelete_spacer">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
			</anchored>
			<disabled />
			<invisible />
		</genericcontrol>
		<!-- FIELDS START HERE -->
		<skilldicepool>
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		</skilldicepool>

		<buttongroup_skill_counteri name="advances">
			<anchored width="30" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		  <sourcefields><current>advances</current></sourcefields>
		  <values><maximum>10</maximum></values>
		</buttongroup_skill_counteri>

		<buttongroup_skill_counter name="advances_edit">
			<anchored width="30" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		  <sourcefields><current>advances</current></sourcefields>
		  <values><maximum>10</maximum></values>
			<invisible />
		</buttongroup_skill_counter>


		<stringu name="characteristic">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
			</anchored>
			<script>
				function onEnter()
					window.windowlist.addEntry(true);
					return true;
				end
			</script>
		</stringu>
		<stringu name="category">
			<anchored width="70" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		</stringu>
		<stringu name="name">
			<anchored height="20">
				<top offset="2" />
				<left offset="40" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
			<tabtarget next="sublabel" />
		</stringu>
		<buttoncontrol name="shortcut">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-20" />
			</anchored>
			<icon normal="button_link" pressed="button_link_down" />
			<script file="campaign/scripts/char_skilllink.lua" />
		</buttoncontrol>
		</sheetdata>
	</windowclass>

	<!-- GENERAL skilllist LIST! .......................................................................... -->
	<windowclass name="npc_skill">
	<margins control="0,0,0,2" />
	<script file="campaign/scripts/char_skill.lua" />
	<sheetdata>
		<button_career_checkbox name="career_skill">
			<bounds>22,8,12,12</bounds>
			<script>
			function onInit()
				if window.windowlist.window.parentcontrol.window.getClass() == "npc" then
					if string.lower(window.windowlist.window.parentcontrol.window.main_npc_category.getValue()) == "minion" then
						setVisible(true);
					else
						setVisible(false);
					end
				end

			end

			function onValueChanged()
				if window.windowlist.window.parentcontrol.window.getClass() == "npc" then
					if string.lower(window.windowlist.window.parentcontrol.window.main_npc_category.getValue()) == "minion" then
						MinionManager.updateSkill(window.getDatabaseNode());
					end
				end
			end
		</script>
		<tooltip textres="npc_sheet_minion_skill" />

		</button_career_checkbox>
		<genericcontrol name="rightanchor">
			<anchored width="0" height="0">
				<top />
				<right />
			</anchored>
			<invisible />
		</genericcontrol>
		<button_idelete name="idelete">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
			</anchored>
		</button_idelete>
		<genericcontrol name="idelete_spacer">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
			</anchored>
			<disabled />
			<invisible />
		</genericcontrol>
		<!-- FIELDS START HERE -->
		<skilldicepool>
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		</skilldicepool>

		<buttongroup_skill_counteri name="advances">
			<anchored width="30" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		  <sourcefields><current>advances</current></sourcefields>
		  <values><maximum>10</maximum></values>
		</buttongroup_skill_counteri>

		<buttongroup_skill_counter name="advances_edit">
			<anchored width="30" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		  <sourcefields><current>advances</current></sourcefields>
		  <values><maximum>10</maximum></values>
			<invisible />
		</buttongroup_skill_counter>



		<stringu name="characteristic">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
			</anchored>
			<script>
				function onEnter()
					window.windowlist.addEntry(true);
					return true;
				end
			</script>
		</stringu>
		<stringu name="category">
			<anchored width="70" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
		</stringu>
		<stringu name="name">
			<anchored height="20">
				<top offset="2" />
				<left offset="40" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
			<tabtarget next="sublabel" />
		</stringu>
		<buttoncontrol name="shortcut">
			<anchored width="20" height="20">
				<top offset="2" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-20" />
			</anchored>
			<icon normal="button_link" pressed="button_link_down" />
			<script file="campaign/scripts/char_skilllink.lua" />
		</buttoncontrol>
		</sheetdata>
	</windowclass>


	<template name="number_charskillfield">
		<basicnumber>
			<delaykeyupdate />
			<hideonvalue>0</hideonvalue>
			<nodrag />
			<displaysign />
		</basicnumber>
	</template>

	<template name="number_charskillranks">
		<basicnumber>
			<delaykeyupdate />
			<hideonvalue>0</hideonvalue>
			<nodrag />
			<min>0</min>
			<script>
				function onWheel(notches)
					if not Input.isControlPressed() then
						return false;
					end

					if not Input.isShiftPressed() then
						setValue(getValue() + notches);
					else
						setValue(getValue() + (notches * 0.5));
					end

					return true;
				end

				function onValueChanged()
					CharManager.updateSkillPoints(window.getDatabaseNode().getChild("..."));
				end
			</script>
		</basicnumber>
	</template>
	<template name="cycler_charskillability">
		<button_stringcycler>
			<parameters>
				<labelsres>BR|AG|INT|CUN|WILL|PR</labelsres>
				<values>BR|AG|IN|CU|WI|PR</values>
			</parameters>
		</button_stringcycler>
	</template>

	<template name="number_charskillfield_static">
		<simplenumber>
			<hideonvalue>0</hideonvalue>
			<nodrag />
			<displaysign />
			<disabled />
		</simplenumber>
	</template>



	<template name="number_charskilltotal">
		<numberfield>
			<frame name="fieldlight" offset="7,5,7,5" />
<!--			<displaysign /> -->
			<rollable/>
				<script file="common/scripts/skilldicepool.lua" />
		</numberfield>
	</template>


	<template name="list_charabilities">
		<list_text>
			<anchored>
				<top offset="35" />
				<left offset="15" />
				<right offset="-15" />
				<bottom offset="-15" />
			</anchored>
			<sortby><control>name</control></sortby>
			<newfocus>name</newfocus>
			<script>
				function onDrop(x, y, draginfo)
					return window.handleDrop(draginfo, getDatabaseNode());
				end
			</script>
		</list_text>
	</template>

	<template name="list_charinv">
		<windowlist>
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<datasource>.inventorylist</datasource>
			<class>char_invitem</class>
			<allowdelete />
			<script file="campaign/scripts/char_invlist.lua" />
		</windowlist>
	</template>

	<template name="list_vehiclesinv">
		<windowlist>
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<datasource>.vehicleslist</datasource>
			<class>char_inv_vehicle</class>
			<allowdelete />
			<script file="campaign/scripts/char_vehicleslist.lua" />
		</windowlist>
	</template>


	<windowclass name="char_invitem">
		<margins control="0,0,0,2" />
		<script>
			function onInit()
				getDatabaseNode().onDelete = onDelete;
			end
			function onDelete(node)
				ItemManager.onCharRemoveEvent(node);
			end
		</script>
		<sheetdata>
			<hidden_record_isidentified name="isidentified"><class>item</class><ignorehost /></hidden_record_isidentified>

			<number_charinv name="count">
				<bounds>5,2,20,20</bounds>
				<tabtarget next="name" />
				<default>1</default>
			</number_charinv>

			<genericcontrol name="rightanchor">
				<anchored width="0" height="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>
			<linkcontrol_id name="shortcut">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
				</anchored>
				<class>item</class>
				<readonly />
			</linkcontrol_id>
			<button_char_inv_carried name="carried">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_char_inv_carried>
			<string_charinvname name="encumbrance">
				<anchored width="30" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
			</string_charinvname>

			<string_charinvloc name="location">
				<anchored width="80" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tabtarget next="encumbrance" prev="nonid_name" />
			</string_charinvloc>

			<string_charinvname name="name">
				<anchored position="insidetopleft" offset="35,2" height="20">
					<right parent="rightanchor" anchor="left" relation="current" offset="-5" />
				</anchored>
				<tabtarget next="nonid_name" prev="count" />
			</string_charinvname>
			<string_charinvname name="nonid_name">
				<anchored position="insidetopleft" offset="35,2" height="20">
					<right parent="rightanchor" anchor="left" relation="current" offset="-5" />
				</anchored>
				<empty textres="library_recordtype_empty_nonid_item" />
				<invisible />
				<tabtarget next="location" prev="name" />
			</string_charinvname>
		</sheetdata>
	</windowclass>

	<windowclass name="char_inv_vehicle">
		<margins control="0,0,0,2" />
		<sheetdata>
			<anchor_listitem_column_right name="rightanchor" />

			<!--			<button_listitem_column_delete name="idelete" /> -->
			<button_idelete name="idelete">
				<anchored to="rightanchor">
					<top />
					<right anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>

			<link_listitem_column name="shortcut">
				<class>vehicle_char</class>
			</link_listitem_column>

			<button_vehicle_enter name="enter_vehicle">
				<anchored to="rightanchor">
					<top />
					<right anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_vehicle_enter>

			<string_listitem_column_name name="name">
					<disabled />
			</string_listitem_column_name>
	<!--				<empty textres="library_recordtype_empty_subracialtrait" />
			</string_listitem_column_name>
	-->
			</sheetdata>
	</windowclass>


	<template name="list_charweapon">
		<windowlist>
			<datasource>.weaponlist</datasource>
			<sortby><control>name</control></sortby>
			<script file="campaign/scripts/char_weaponlist.lua" />
		</windowlist>
	</template>
	<template name="state_charweapontype">
		<buttonfield>
			<anchored width="25" height="25" />
			<state icon="char_weapon_melee" tooltipres="char_tooltip_weapontypemelee" />
			<state icon="char_weapon_ranged" tooltipres="char_tooltip_weapontyperanged" />
			<script>
				function onInit()
					if DataCommon.isPFRPG() then
						setStateIcons(2, "char_weapon_cm");
						setStateTooltipText(2, Interface.getString("char_tooltip_weapontypecm"));
					end
				end
			</script>
		</buttonfield>
	</template>

	<template name="number_charweaponfullattack">
		<basicnumber>
			<frame merge="delete" />
			<icons>
				<container>attackicons</container>
				<icon>field_rollable</icon>
				<offsetx>0</offsetx>
				<offsety>0</offsety>
			</icons>
			<attackfields>
				<attack1>attack1</attack1>
				<attack2>attack2</attack2>
				<attack3>attack3</attack3>
				<attack4>attack4</attack4>
			</attackfields>
			<namefield>name</namefield>
			<default>1</default>
			<min>1</min>
			<max>4</max>
			<script file="campaign/scripts/char_weaponfullattack.lua" />
		</basicnumber>
	</template>
	<template name="number_charweaponattackmod">
		<simplenumber>
			<stateframe>
				<keyedit name="fieldfocus" offset="5,5,5,5" />
				<hover name="fieldfocus" offset="5,5,5,5" />
				<drophilight name="fieldfocus" offset="5,5,5,5" />
			</stateframe>
			<displaysign />
		</simplenumber>
	</template>
	<template name="state_charammocounter">
		<buttongroup_counter>
			<sourcefields>
				<maximum>maxammo</maximum>
				<current>ammo</current>
			</sourcefields>
		</buttongroup_counter>
	</template>


<!-- newly added genesys -->




</root>
